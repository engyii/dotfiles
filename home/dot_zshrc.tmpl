#!/usr/bin/env zsh
# .zshrc - Zsh configuration file

# Path setup
export PATH="$HOME/.local/bin:$PATH"

# History configuration
HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt appendhistory
setopt share_history        # share history between sessions
setopt extended_history     # add timestamps to history
setopt hist_ignore_dups     # don't record duplicated commands
setopt hist_ignore_space    # don't record commands starting with space

# Basic zsh options
setopt auto_cd              # cd by typing directory name
setopt interactive_comments # Allow comments in interactive mode
setopt no_beep              # No beep on error
setopt prompt_subst         # Enable prompt substitution

# Load zap plugin manager
[ -f "$HOME/.local/share/zap/zap.zsh" ] && source "$HOME/.local/share/zap/zap.zsh"

# Zap plugins
plug "zsh-users/zsh-autosuggestions"
plug "zsh-users/zsh-syntax-highlighting"
plug "zap-zsh/supercharge"
plug "zap-zsh/fzf"
plug "zap-zsh/exa"
plug "hlissner/zsh-autopair"
{{- if .features.git }}
plug "Aloxaf/fzf-tab"
{{- end }}

# FZF configuration
{{- if .features.fzf }}
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
export FZF_DEFAULT_OPTS=" \
--color=bg+:#{{ if eq .theme "catppuccin-latte" }}eff1f5{{ else if eq .theme "catppuccin-frappe" }}414559{{ else if eq .theme "catppuccin-macchiato" }}363a4f{{ else }}313244{{ end }},bg:#{{ if eq .theme "catppuccin-latte" }}eff1f5{{ else if eq .theme "catppuccin-frappe" }}303446{{ else if eq .theme "catppuccin-macchiato" }}24273a{{ else }}1e1e2e{{ end }},spinner:#f5e0dc,hl:#f38ba8 \
--color=fg:#{{ if eq .theme "catppuccin-latte" }}4c4f69{{ else }}cdd6f4{{ end }},header:#f38ba8,info:#cba6f7,pointer:#f5e0dc \
--color=marker:#f5e0dc,fg+:#{{ if eq .theme "catppuccin-latte" }}4c4f69{{ else }}cdd6f4{{ end }},prompt:#cba6f7,hl+:#f38ba8"
{{- end }}

# Modern tools aliases
{{- if .features.terminal_utils }}
alias ls='exa --icons --group-directories-first'
alias ll='exa -lh --icons --group-directories-first'
alias la='exa -lah --icons --group-directories-first'
alias lt='exa --tree --icons --group-directories-first'
alias cat='bat --style=plain'
alias grep='rg'
alias find='fd'
{{- end }}

# Git aliases
{{- if .features.git }}
alias g='git'
alias gs='git status'
alias ga='git add'
alias gc='git commit'
alias gp='git push'
alias gpl='git pull'
alias gl='git log --oneline'
alias gd='git diff'
{{- end }}

# Node.js environment
{{- if .features.node }}
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion
{{- end }}

# Tmux configuration
{{- if .features.tmux }}
if [ -z "$TMUX" ] && [ -n "$SSH_TTY" ] && [[ $- =~ i ]]; then
  tmux attach-session -t ssh_tmux || tmux new-session -s ssh_tmux
fi
{{- end }}

# Initialize starship prompt if installed
if command -v starship &> /dev/null; then
    eval "$(starship init zsh)"
fi

# Custom functions

# Create a new directory and enter it
function mkcd() {
  mkdir -p "$@" && cd "$@"
}

# Extract most know archives
function extract() {
  if [ -f $1 ] ; then
    case $1 in
      *.tar.bz2)   tar xjf $1     ;;
      *.tar.gz)    tar xzf $1     ;;
      *.bz2)       bunzip2 $1     ;;
      *.rar)       unrar e $1     ;;
      *.gz)        gunzip $1      ;;
      *.tar)       tar xf $1      ;;
      *.tbz2)      tar xjf $1     ;;
      *.tgz)       tar xzf $1     ;;
      *.zip)       unzip $1       ;;
      *.Z)         uncompress $1  ;;
      *.7z)        7z x $1        ;;
      *)           echo "'$1' cannot be extracted via extract()" ;;
    esac
  else
    echo "'$1' is not a valid file"
  fi
}

# Load local customizations if present
[[ -f ~/.zshrc.local ]] && source ~/.zshrc.local